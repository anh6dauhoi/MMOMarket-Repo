<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>My Complaints</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
    <link rel="stylesheet" th:href="@{/customer/css/my-complaints.css}">
    <style>
        body {
            background: url('/images/home1.jpg') no-repeat center center fixed;
            -webkit-background-size: cover;
            -moz-background-size: cover;
            -o-background-size: cover;
            background-size: cover;
        }
        @media (max-width: 640px) {
            body { background-position: top center; }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col">
<div th:insert="~{fragments/header :: header}"></div>

<main class="flex-grow py-6">
    <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
            <div class="md:col-span-1">
                <div th:replace="~{customer/account-setting :: sidebar}"></div>
            </div>
            <div class="md:col-span-3">
                <div class="card-modern p-6">
                    <!-- Header -->
                    <div class="flex items-center justify-between mb-6">
                        <div>
                            <h1 class="page-title">My Complaints</h1>
                            <p class="text-gray-500 mt-1 text-sm">Track and manage your complaints</p>
                        </div>
                        <div class="flex items-center space-x-2 text-xs">
                            <i class="fas fa-exclamation-triangle text-red-400"></i>
                            <span class="text-gray-600">Total:</span>
                            <span class="font-bold text-red-500" th:text="${totalElements ?: 0}">0</span>
                            <span class="text-gray-600">complaints</span>
                        </div>
                    </div>

                    <!-- Search and Filter Controls -->
                    <div class="mb-5 bg-gradient-to-r from-gray-50 to-red-50 rounded-xl p-5 border border-red-100">
                        <form method="get" th:action="@{/account/complaints}" class="space-y-4">
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                <!-- Search Input -->
                                <div class="relative">
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-search text-red-500 mr-1"></i>Search Complaints
                                    </label>
                                    <div class="relative">
                                        <input type="text"
                                               name="search"
                                               th:value="${param.search}"
                                               placeholder="Search by type, description, or status..."
                                               class="w-full pl-10 pr-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all text-gray-700">
                                        <i class="fas fa-search absolute left-3 top-1/2 transform -translate-y-1/2 text-red-400 text-sm"></i>
                                    </div>
                                </div>

                                <!-- Status Filter Select -->
                                <div>
                                    <label class="block text-sm font-semibold text-gray-700 mb-2">
                                        <i class="fas fa-filter text-red-500 mr-1"></i>Filter by Status
                                    </label>
                                    <select name="status"
                                            class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-transparent transition-all text-gray-700">
                                        <option value="">All Statuses</option>
                                        <option value="NEW" th:selected="${param.status != null and param.status[0] == 'NEW'}">
                                            üÜï New
                                        </option>
                                        <option value="IN_PROGRESS" th:selected="${param.status != null and param.status[0] == 'IN_PROGRESS'}">
                                            üîÑ In Progress
                                        </option>
                                        <option value="PENDING_CONFIRMATION" th:selected="${param.status != null and param.status[0] == 'PENDING_CONFIRMATION'}">
                                            ‚è≥ Pending Confirmation
                                        </option>
                                        <option value="ESCALATED" th:selected="${param.status != null and param.status[0] == 'ESCALATED'}">
                                            ‚¨ÜÔ∏è Escalated
                                        </option>
                                        <option value="RESOLVED" th:selected="${param.status != null and param.status[0] == 'RESOLVED'}">
                                            ‚úÖ Resolved
                                        </option>
                                        <option value="CLOSED_BY_ADMIN" th:selected="${param.status != null and param.status[0] == 'CLOSED_BY_ADMIN'}">
                                            üîí Closed by Admin
                                        </option>
                                        <option value="CANCELLED" th:selected="${param.status != null and param.status[0] == 'CANCELLED'}">
                                            ‚ùå Cancelled
                                        </option>
                                    </select>
                                </div>
                            </div>

                            <!-- Action Buttons -->
                            <div class="flex items-center justify-between pt-2">
                                <div class="text-sm text-gray-600">
                                    <i class="fas fa-info-circle text-red-400 mr-1"></i>
                                    <span class="font-semibold text-red-600" th:text="${totalElements ?: 0}">0</span> results found
                                </div>
                                <div class="flex gap-2">
                                    <a th:href="@{/account/complaints}"
                                       class="px-4 py-2 rounded-lg bg-gray-200 hover:bg-gray-300 text-gray-700 font-medium transition-colors duration-200 flex items-center">
                                        <i class="fas fa-redo mr-2"></i>Clear
                                    </a>
                                    <button type="submit"
                                            class="px-6 py-2 rounded-lg bg-red-500 hover:bg-red-600 text-white font-medium shadow-md hover:shadow-lg transition-all duration-200 flex items-center">
                                        <i class="fas fa-check mr-2"></i>Apply Filters
                                    </button>
                                </div>
                            </div>
                            <input type="hidden" name="page" value="0"/>
                        </form>
                    </div>

                    <!-- Table -->
                    <div class="overflow-x-auto rounded-lg">
                        <table class="min-w-full">
                            <thead class="table-header">
                            <tr>
                                <th class="text-left text-xs font-bold text-red-700 uppercase tracking-wider" style="width: 8%;">#</th>
                                <th class="text-left text-xs font-bold text-red-700 uppercase tracking-wider" style="width: 30%;">
                                    <i class="fas fa-box mr-1"></i>Product Name
                                </th>
                                <th class="text-left text-xs font-bold text-red-700 uppercase tracking-wider" style="width: 30%;">
                                    <i class="fas fa-info-circle mr-1"></i>Status
                                </th>
                                <th class="text-left text-xs font-bold text-red-700 uppercase tracking-wider" style="width: 17%;">
                                    <i class="fas fa-calendar mr-1"></i>Date
                                    <a th:href="@{/account/complaints(page=${currentPage}, search=${param.search}, sortBy='date', sortDir=${param.sortDir != null and param.sortDir[0] == 'asc' ? 'desc' : 'asc'})}"
                                       class="sort-icon inline-block">
                                        <i th:class="'fas ' + (${param.sortBy != null and param.sortBy[0] == 'date'} ? (${param.sortDir != null and param.sortDir[0] == 'asc'} ? 'fa-sort-up' : 'fa-sort-down') : 'fa-sort')"></i>
                                    </a>
                                </th>
                                <th class="text-center text-xs font-bold text-red-700 uppercase tracking-wider" style="width: 15%;">
                                    <i class="fas fa-cog mr-1"></i>Actions
                                </th>
                            </tr>
                            </thead>
                            <tbody class="bg-white">
                            <tr class="table-row" th:each="c : ${complaints}">
                                <td class="text-sm font-bold text-gray-500" th:text="${c['index']}">1</td>
                                <td>
                                    <div class="flex items-center">
                                        <div class="product-icon bg-gradient-to-br from-red-100 to-red-200 rounded-lg flex items-center justify-center">
                                            <i class="fas fa-box text-red-500 text-sm"></i>
                                        </div>
                                        <div class="ml-3">
                                            <div class="text-sm font-semibold text-gray-900" th:text="${c['productName']}">Product Name</div>
                                            <div class="text-xs text-gray-500">ID: #<span th:text="${c['id']}">123</span></div>
                                        </div>
                                    </div>
                                </td>
                                <td>
                                    <span th:class="'status-badge ' + ${c['statusRaw'] == 'NEW' ? 'status-new' : (c['statusRaw'] == 'IN_PROGRESS' ? 'status-in-progress' : (c['statusRaw'] == 'PENDING_CONFIRMATION' ? 'status-pending' : (c['statusRaw'] == 'ESCALATED' ? 'status-escalated' : (c['statusRaw'] == 'RESOLVED' ? 'status-resolved' : (c['statusRaw'] == 'CLOSED_BY_ADMIN' ? 'status-closed' : (c['statusRaw'] == 'CANCELLED' ? 'status-cancelled' : ''))))))}"
                                          th:text="${c['status']}">New</span>
                                </td>
                                <td>
                                    <div class="text-xs text-gray-900 font-semibold" th:text="${#dates.format(c['createdAt'], 'dd/MM/yyyy')}">01/01/2025</div>
                                    <div class="text-xs text-gray-500" th:text="${#dates.format(c['createdAt'], 'HH:mm')}">00:00</div>
                                </td>
                                <td>
                                    <div class="flex items-center justify-center">
                                        <a class="btn-detail inline-flex items-center space-x-1"
                                           th:href="@{/account/complaints/{id}(id=${c['id']})}">
                                            <i class="fas fa-eye"></i>
                                            <span>View Detail</span>
                                        </a>
                                    </div>
                                </td>
                            </tr>
                            <tr th:if="${complaints == null or #lists.isEmpty(complaints)}">
                                <td class="py-12 text-center" colspan="5">
                                    <div class="flex flex-col items-center">
                                        <i class="fas fa-exclamation-triangle text-gray-300 text-5xl mb-3"></i>
                                        <p class="text-gray-500 text-base font-semibold">No complaints found</p>
                                        <p class="text-gray-400 text-xs mt-1">Your complaints will appear here</p>
                                    </div>
                                </td>
                            </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Pagination -->
                    <div class="mt-6 flex justify-center items-center space-x-1" th:if="${totalPages > 1}">
                        <a th:class="'pagination-btn ' + (${currentPage == 0} ? 'disabled' : '')"
                           th:href="@{/account/complaints(page=${currentPage - 1}, search=${param.search}, status=${param.status}, sortBy=${param.sortBy}, sortDir=${param.sortDir})}">
                            <i class="fas fa-chevron-left text-xs"></i>
                        </a>

                        <span th:each="i : ${#numbers.sequence(0, totalPages - 1)}">
                            <a th:class="'pagination-btn ' + (${currentPage == i} ? 'active' : '')"
                               th:href="@{/account/complaints(page=${i}, search=${param.search}, status=${param.status}, sortBy=${param.sortBy}, sortDir=${param.sortDir})}"
                               th:text="${i + 1}"></a>
                        </span>

                        <a th:class="'pagination-btn ' + (${currentPage == totalPages - 1} ? 'disabled' : '')"
                           th:href="@{/account/complaints(page=${currentPage + 1}, search=${param.search}, status=${param.status}, sortBy=${param.sortBy}, sortDir=${param.sortDir})}">
                            <i class="fas fa-chevron-right text-xs"></i>
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</main>

<div th:insert="~{fragments/footer :: footer}"></div>

<script>
    document.addEventListener('DOMContentLoaded', () => {
        // Auto-submit search on input change with debounce
        const searchInput = document.querySelector('input[name="search"]');
        if (searchInput) {
            let timeout;
            searchInput.addEventListener('input', function() {
                clearTimeout(timeout);
                timeout = setTimeout(() => {
                    this.form.submit();
                }, 500);
            });
        }
    });
</script>
</body>
</html>

